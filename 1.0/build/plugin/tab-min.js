/*! search-suggest - v1.0 - 2013-06-07 11:30:32 AM
* Copyright (c) 2013 yuncong; Licensed  */
KISSY.add("gallery/search-suggest/1.0/plugin/tab",function(a,b,c,d,e){function f(a){f.superclass.constructor.call(this,a||{})}return a.extend(f,b,{pluginInitializer:function(a){this._initPluginEvent.call(this,a)},tabClick:function(a){var b,d=this,e=d.get("caller"),f=a.currentTarget,g=c.attr(f,"data-searchtype"),h=c.attr(f,"data-defaultpage"),i=c.attr(f,"data-action"),j=e.comboBox.get("input"),k=c.parent(j,"form"),l=d.get("activeCls");if(c.removeClass(c.siblings(f),l),c.addClass(f,l),h&&k.setAttribute("data-defaultpage",h),i&&k.setAttribute("action",i),g)b=d.getDefCfg(g),i&&(b.action=i),e.update(b);else{var m=e.query||j.val(),n=c.get("a",f);if(n){var o=c.attr(n,"href");o=o.replace("/?","/search?"),o=o+"&q="+m,c.attr(n,"href",o)}}a.preventDefault()},_initPluginEvent:function(b){var c=this,e=b.get("sugConfig"),f=c.get("activeCls"),g=e.tablist;c.set("caller",b),g&&(d.on(g,"click",c.tabClick,c),a.all(g).each(function(a){a.hasClass(f)&&(b.tabNode=a)}))},update:function(b){var d,f,g,h=this,i=h.get("caller"),j=i.comboBox,k=b.sugConfig.tab,l=i.configArr[k],m=b.sugConfig,n=j.get("input"),o=c.parent(n,"form");i.configArr=i.configArr||[],f=i.get("dataSourceCfg"),g=f.xhrCfg,g.url=m.sourceUrl,a.mix(i.__attrVals,b,{deep:!0}),l?d=l.data:l=i.configArr[k]=""===g.url?{data:new e.LocalDataSource({data:{},parse:f.parse})}:{data:new e.RemoteDataSource(f)},j.set("dataSource",l.data),o&&c.attr(o,"action",b.action),n[0].focus(),j.sendRequest(i.query)},getDefCfg:function(b){var c;switch(b){case"shop":c={sugConfig:{sourceUrl:"http://suggest.taobao.com/sug?area=ssrch&k=1",resultFormat:"",tab:"shop",excludeParam:["q"]},mods:{tel:{index:!1},cat:{index:!1},"new":{index:!1},jipiao:{index:!1},shop:{index:!1},tdg:{index:!1},showExtra:!1},action:"http://shopsearch.taobao.com/search",tab:"shop"};break;case"item":c={sugConfig:{sourceUrl:"http://suggest.taobao.com/sug?k=1",resultFormat:"\u7ea6{count}\u4e2a\u5b9d\u8d1d",tab:"item",excludeParam:["q"]},mods:{cat:{index:4},"new":{index:6},jipiao:{index:8},global:{index:5},shop:{index:7},tdg:{index:9},showExtra:!0},action:"http://s.taobao.com/search"};break;case"mall":c={sugConfig:{sourceUrl:"http://suggest.taobao.com/sug?area=b2c&k=1",resultFormat:"\u7ea6{count}\u4e2a\u5b9d\u8d1d",tab:"mall",excludeParam:["q"]},mods:{cat:{index:4},"new":{index:-1},jipiao:{index:-1},global:{index:5},shop:{index:-1},tdg:{index:9},tel:{index:-1},showExtra:!0},action:"http://list.tmall.com/search_product.htm"};break;default:if(!a.isObject(b))return a.log("\u914d\u7f6e\u6709\u8bef"),void 0;c=b,c.sugConfig||(c.sugConfig={})}return c.sugConfig&&!c.sugConfig.tab&&(c.sugConfig.tab=c.sugConfig.sourceUrl),c}},{ATTRS:{pluginId:{value:"tab"},caller:{value:null}}}),f},{requires:["base","dom","event","combobox"]});