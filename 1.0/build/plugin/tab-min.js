/*! search-suggest - v1.0 - 2013-06-08 2:16:02 PM
* Copyright (c) 2013 yuncong; Licensed  */
KISSY.add("gallery/search-suggest/1.0/plugin/tab",function(a,b,c,d,e){function f(a){f.superclass.constructor.call(this,a||{})}return a.extend(f,b,{pluginInitializer:function(a){this._initPluginEvent.call(this,a)},tabClick:function(b){var d,e=this,f=e.get("caller"),g=b.currentTarget,h=c.attr(g,"data-searchtype"),i=c.attr(g,"data-defaultpage"),j=c.attr(g,"data-action"),k=f.comboBox.get("input"),l=c.parent(k,"form"),m=e.get("activeCls");if(c.removeClass(c.siblings(g),m),c.addClass(g,m),f.tabNode=a.one(g),i&&l.setAttribute("data-defaultpage",i),j&&l.setAttribute("action",j),h)d=e.getDefCfg(h),j&&(d.action=j),f.update(d);else{var n=f.query||k.val(),o=c.get("a",g);if(o){var p=c.attr(o,"href");p=p.replace("/?","/search?"),p=p+"&q="+n,c.attr(o,"href",p)}}b.preventDefault()},_initPluginEvent:function(b){var c=this,e=c.get("activeCls"),f=c.get("node")||b.get("sugConfig").tablist;c.set("caller",b),f&&(d.on(f,"click",c.tabClick,c),a.all(f).each(function(a){a.hasClass(e)&&(b.tabNode=a)}))},update:function(b){var d,f,g,h=this,i=h.get("caller"),j=i.comboBox,k=b.sugConfig.tab,l=i.configArr[k],m=b.sugConfig,n=j.get("input"),o=c.parent(n,"form");i.configArr=i.configArr||[],f=i.get("dataSourceCfg"),g=f.xhrCfg,g.url=m.sourceUrl,a.mix(i.__attrVals,b,{deep:!0}),l?d=l.data:l=i.configArr[k]=""===g.url?{data:new e.LocalDataSource({data:{},parse:f.parse})}:{data:new e.RemoteDataSource(f)},j.set("dataSource",l.data),o&&c.attr(o,"action",b.action),n[0].focus(),j.sendRequest(i.query)},getDefCfg:function(b){var c;switch(b){case"shop":c={sugConfig:{sourceUrl:"http://suggest.taobao.com/sug?area=ssrch&k=1",resultFormat:"",tab:"shop",excludeParam:["q"]},mods:{tel:{index:!1},cat:{index:!1},"new":{index:!1},jipiao:{index:!1},shop:{index:!1},tdg:{index:!1},showExtra:!1},action:"http://shopsearch.taobao.com/search",tab:"shop"};break;case"item":c={sugConfig:{sourceUrl:"http://suggest.taobao.com/sug?k=1",resultFormat:"\u7ea6{count}\u4e2a\u5b9d\u8d1d",tab:"item",excludeParam:["q"]},mods:{cat:{index:4},"new":{index:6},jipiao:{index:8},global:{index:5},shop:{index:7},tdg:{index:9},showExtra:!0},action:"http://s.taobao.com/search"};break;case"mall":c={sugConfig:{sourceUrl:"http://suggest.taobao.com/sug?area=b2c&k=1",resultFormat:"\u7ea6{count}\u4e2a\u5b9d\u8d1d",tab:"mall",excludeParam:["q"]},mods:{cat:{index:4},"new":{index:-1},jipiao:{index:-1},global:{index:5},shop:{index:-1},tdg:{index:9},tel:{index:-1},showExtra:!0},action:"http://list.tmall.com/search_product.htm"};break;default:if(!a.isObject(b))return a.log("\u914d\u7f6e\u6709\u8bef"),void 0;c=b,c.sugConfig||(c.sugConfig={})}return c.sugConfig&&!c.sugConfig.tab&&(c.sugConfig.tab=c.sugConfig.sourceUrl),c}},{ATTRS:{pluginId:{value:"tab"},caller:{value:null}}}),f},{requires:["base","dom","event","combobox"]});